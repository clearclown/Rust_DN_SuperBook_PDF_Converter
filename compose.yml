# DN_SuperBook_PDF_Converter - Podman Compose
# Usage: podman compose up -d
#
# Build first: podman compose build
# Convert PDFs: podman compose run --rm converter ConvertPdf /data/input /dst:/data/output
# With OCR:     podman compose run --rm converter ConvertPdf /data/input /dst:/data/output /ocr:yes
# Shell:        podman compose run --rm converter /bin/bash

services:
  converter:
    build:
      context: .
      dockerfile: Containerfile
    image: superbook-pdf-converter:latest
    container_name: superbook-converter

    # NVIDIA GPU support
    devices:
      - nvidia.com/gpu=all

    # Security options for rootless podman
    security_opt:
      - label=disable

    # Volume mounts
    volumes:
      - ./examples/00_before:/data/input:ro
      - ./examples/02_after:/data/output:rw

    # Environment
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility
      - DOTNET_CLI_TELEMETRY_OPTOUT=1

    # Working directory
    working_dir: /data

    # Keep container running for interactive use
    # Comment out for one-shot conversion
    stdin_open: true
    tty: true

    # Default command (shows help)
    # Override with: podman compose run converter ConvertPdf ...
    command: ["--help"]
